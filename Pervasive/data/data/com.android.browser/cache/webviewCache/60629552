function CFolderMgr(){var _previewStatus={None:0,Loading:1,Cached:2};window.PreviewStatus=_previewStatus;var _messageStatus={Unread:0,Read:1,Replied:2,Forwarded:4};window.MessageStatus=_messageStatus;var _folderMgr=this;_folderMgr._pageSize=10;_folderMgr._selectedMessagesIds=[];_folderMgr._previews=[];_folderMgr.getSelectedMessagesIds=function(){return _folderMgr._selectedMessagesIds.slice()};_folderMgr.getIds=function(){return _folderMgr._ids};_folderMgr.getMessageCount=function(){return _folderMgr._ids.length};_folderMgr.allMessagesSelected=function(){return _folderMgr._selectedMessagesIds.length==_folderMgr._ids.length};_folderMgr.getSelectionCount=function(){return _folderMgr._selectedMessagesIds.length};_folderMgr.setSelected=function(a,b){if(b)_folderMgr._selectedMessagesIds.push(a);else _folderMgr._selectedMessagesIds.remove(a)};_folderMgr.getPreviewStatus=function(a){return _folderMgr._previews[a]};_folderMgr.getUnreadCount=function(){return _folderMgr._unread};_folderMgr.setUnreadCount=function(a){_folderMgr._unread=a};_folderMgr.isRead=function(a){return _folderMgr._ms[a]&_messageStatus.Read};_folderMgr.isReplied=function(a){return _folderMgr._ms[a]&_messageStatus.Replied};_folderMgr.isForwarded=function(a){return _folderMgr._ms[a]&_messageStatus.Forwarded};_folderMgr.setRead=function(a,b){if(b)_folderMgr._ms[a]|=_messageStatus.Read;else _folderMgr._ms[a]&=~_messageStatus.Read};_folderMgr.getRequest=function(a,b){if(b)window.location.href=RequestMgr.addToQuery(a,"mid",_folderMgr._mapId(b));else window.location.href=a};_folderMgr.compose=function(d,b){var c=encodeURIComponent(RequestMgr.addToQuery(RequestMgr.getUrl("folders","",false),"fid",_folderMgr._cfid,"mid",_folderMgr._prevMid,"adt",_folderMgr._prevAdt,"q",_folderMgr._q,"dir",_folderMgr._dir,"pi",_folderMgr._pi)),a=RequestMgr.addToQuery(RequestMgr.getUrl("compose",d,false),"fid",_folderMgr._cfid,"iru",c);if(b!=typeof "undefined")a=RequestMgr.addToQuery(a,"mid",_folderMgr._mapId(b));_folderMgr.getRequest(a)};_folderMgr.getMessagePreview=function(a){_folderMgr._previews[a]=_previewStatus.Loading;var b=new RequestInfo(RequestMgr.getUrl("messages","preview",true),"POST",_folderMgr._onGetMessagePreview,RequestMgr.addToPayload("","mid",_folderMgr._mapId(a),"fid",_folderMgr._cfid),a);_folderMgr._addRequest(b,false,false)};_folderMgr.markReadUnread=function(c,b){var a=new RequestInfo(RequestMgr.getUrl("messages","markAs/"+(b?"read":"unread"),true),"POST",null,RequestMgr.addToPayload("","fid",_folderMgr._cfid,"msglist",_folderMgr._idsToMsgList(c),"update","true"),"");_folderMgr._addRequest(a,false,false)};_folderMgr.mark=function(b,d,a){_folderMgr._remove(b);var c=new RequestInfo(RequestMgr.getUrl("messages",d,true),"POST",a?_folderMgr._onPaginate:_folderMgr._onNewMessages,RequestMgr.addToPayload("","msglist",_folderMgr._idsToMsgList(b),"update","true"));_folderMgr._addRequest(c,true,a)};_folderMgr.move=function(d,e,c,a){_folderMgr._remove(d);var b=new RequestInfo(RequestMgr.getUrl("messages","move",true),"POST",c?_folderMgr._onPaginate:_folderMgr._onNewMessages,RequestMgr.addToPayload("","msglist",_folderMgr._idsToMsgList(d),"src",_folderMgr._cfid,"dest",e,"update","true"));if(a&&a!="")b.payload=RequestMgr.appendToPayload(b.payload,a);_folderMgr._addRequest(b,true,c)};_folderMgr.paginate=function(b,d,c){_folderMgr._remove(FolderMgr._ids.slice());var a=new RequestInfo(RequestMgr.getUrl("messages","paginate",true),"POST",_folderMgr._onPaginate,RequestMgr.addToPayload("","dir",b,"pi",d));if(c&&c!="")a.payload=RequestMgr.appendToPayload(a.payload,c);if(b=="next")a.requestType=RequestType.PaginateNext;else if(b=="prev")a.requestType=RequestType.PaginatePrev;_folderMgr._addRequest(a,true,true)};_folderMgr._addRequest=function(b,c,a){if(c)b.queueCallback=_folderMgr._updateQueue;if(a)_folderMgr._bid=0;RequestMgr.enqueueRequest(b);if(a)RequestMgr.acceptsRequests=false};_folderMgr._onGetMessagePreview=function(b,a){_folderMgr._previews[a]=_previewStatus.Cached;FolderView.setPreview(a,b)};_folderMgr._onNewMessages=function(preMsgs,preScript,postMsgs,postScript,paginationControl,paginationScripts,unreadCountScripts,replaceOldData){if(replaceOldData)_folderMgr._previews=[];var preCount=_folderMgr._evalNewMessagesResponse(replaceOldData,preScript,true);if(preCount>0){FolderView.addNewMessages(preMsgs,true);var idsToRemove=[];for(var i=_folderMgr._pageSize;i<_folderMgr._ids.length;i++)idsToRemove.push(_folderMgr._ids[i]);if(idsToRemove.length>0){_folderMgr._remove(idsToRemove);FolderView.remove(idsToRemove)}}var postCount=_folderMgr._evalNewMessagesResponse(replaceOldData,postScript,false);if(postCount>0)FolderView.addNewMessages(postMsgs,false);eval(paginationScripts);FolderView.setPagination(paginationControl);eval(unreadCountScripts);FolderView.updateUi(replaceOldData)};_folderMgr._onPaginate=function(g,e,f,d,b,c,a){RequestMgr.acceptsRequests=true;FolderView.clearUi();_folderMgr._onNewMessages(g,e,f,d,b,c,a,true)};_folderMgr._updateQueue=function(a){var b,c;if(_folderMgr._ids.length>0){b=_folderMgr._mapId(_folderMgr._ids[0]);c=_folderMgr._mapId(_folderMgr._ids[_folderMgr._ids.length-1])}else b=c="";var e="",d="";switch(a.requestType){case RequestType.PaginateNext:e=_folderMgr._nextMid;d=_folderMgr._nextAdt;break;default:e=_folderMgr._prevMid;d=_folderMgr._prevAdt}a.payload=RequestMgr.addToPayload(a.payload,"bid",_folderMgr._bid,"mid",e,"adt",d,"fmid",b,"lmid",c,"fid",_folderMgr._cfid,"q",_folderMgr._q);if(a.requestType==RequestType.Other)a.payload=RequestMgr.addToPayload(a.payload,"pi",_folderMgr._pi,"dir",_folderMgr._dir);return a};_folderMgr._evalNewMessagesResponse=function(replaceOldData,script,prepend){if(!script||script.length===0)return 0;eval(script);var count=_tt.length;if(replaceOldData){_folderMgr._tt=_tt;_folderMgr._ms=_ms;_folderMgr._ids=_ids}else{_folderMgr._tt=_folderMgr._tt.concat(_tt);_folderMgr._ms=_folderMgr._ms.concat(_ms);_folderMgr._ids=prepend?_ids.concat(_folderMgr._ids):_folderMgr._ids.concat(_ids)}_folderMgr._bid=_bid;_tt=_ms=_ids=null;return count};_folderMgr._remove=function(b){for(var a=0;a<b.length;a++){var c=b[a];_folderMgr._ids.remove(c);_folderMgr._selectedMessagesIds.remove(c)}};_folderMgr._mapId=function(a){return _folderMgr._tt[a]};_folderMgr._idsToMsgList=function(c){var b="";for(var a=0;a<c.length;a++)b=b+_folderMgr._tt[c[a]]+(a<c.length-1?"|":"");return b}}window.FolderMgr=window.FolderMgr||new CFolderMgr;function CFolderView(){var a=this;a._ignoreCheckboxEvents=false;a.onSearch=function(){var a=$("c_search_Search_box")||$("c_search_SearchTop_box"),b=a.value;FolderMgr.getRequest(RequestMgr.addToQuery(RequestMgr.getUrl("folders","",false),"q",encodeURIComponent(b)))};a.paginationCallback=function(d,b){var c=b+1;if(b===0)a.paginate("first",1);else if(b>d.current)a.paginate("next",c);else a.paginate("prev",c)};a.compose=function(a,b){FolderMgr.compose(a,b)};a.toggleSelectAll=function(b){if(a._ignoreCheckboxEvents)return;a._ignoreCheckboxEvents=true;if(b.checked||FolderMgr.allMessagesSelected()){var d=FolderMgr.getIds();for(var c=0;c<d.length;c++)a._setSelection(d[c],b.checked,true)}ActionBarMgr.updateSelectionCount(FolderMgr.getSelectionCount());ActionBarMgr.updateMasterCheckbox(b.checked);NotifMgr.close();a._ignoreCheckboxEvents=false};a.toggleSelection=function(b,c){if(a._ignoreCheckboxEvents)return;a._ignoreCheckboxEvents=true;a._setSelection(c,b.checked,false);if(!b.checked)ActionBarMgr.updateMasterCheckbox(false);else if(FolderMgr.allMessagesSelected())ActionBarMgr.updateMasterCheckbox(true);ActionBarMgr.updateSelectionCount(FolderMgr.getSelectionCount());a._ignoreCheckboxEvents=false};a.togglePreview=function(g,d,f){var b=parseInt(d.substring("pnlHidden".length),10);if(f){var c=FolderMgr.getPreviewStatus(b);if(!c||c==PreviewStatus.None){FolderMgr.getMessagePreview(b);$("pnlPreview"+b).innerHTML=$("pnlLoadingBar").innerHTML;var e=$("pnlCxtMenu").innerHTML.replace(/XXX/g,b);$("pnlMenu"+b).innerHTML=e;a._updateReadUnreadCtxMenu(b,FolderMgr.isRead(b))}}};a.markReadUnread=function(d){var b=a._prepareRequest();if(!b)return;FolderMgr.markReadUnread(b,d);for(var c=0;c<b.length;c++)a._updateReadUnreadUi(b[c],d);a._updateBreadCrumbs()};a.singleMarkReadUnread=function(b){$menu.closeCurrent();var c=!FolderMgr.isRead(b);FolderMgr.markReadUnread([b],c);a._updateReadUnreadUi(b,c);a._updateBreadCrumbs()};a.deleteSelected=function(d){var b=a._prepareRequest();if(!b)return;var c=FolderMgr.allMessagesSelected();FolderMgr.move(b,d,c,"a=d");if(!c)a.remove(b)};a.move=function(d,f,e){var b=a._prepareRequest(f);if(!b)return;var c=FolderMgr.allMessagesSelected();FolderMgr.move(b,d,c,e);if(!c)a.remove(b)};a.mark=function(d,e){var b=a._prepareRequest(e);if(!b)return;var c=FolderMgr.allMessagesSelected();FolderMgr.mark(b,d,c);if(!c)a.remove(b)};a.paginate=function(a,c,b){FolderMgr.paginate(a,c,b)};a.remove=function(c){var d=a._getList();for(var b=0;b<c.length;b++)d.removeChild($("liMsg"+c[b]));ActionBarMgr.updateSelectionCount(FolderMgr.getSelectionCount())};a.setPreview=function(c,b){var a=$("pnlPreview"+c);if(a)a.innerHTML=b};a.setPagination=function(a){$("pnlPagination").innerHTML=a};a.addNewMessages=function(f,g){var e=a._getList(),c=document.createElement("ul");c.innerHTML=f;var d=null;while(c.childNodes.length>0){var b=c.firstChild;c.removeChild(b);if(b.nodeType!=1)continue;if(g){if(!d)d=e.firstChild;e.insertBefore(b,d)}else e.appendChild(b)}};a.updateUi=function(c){var b=FolderMgr.getMessageCount();if(b===0){NotifMgr.showMessage("noMsgs");$css.add($("pnlPagination"),"hidden")}else{NotifMgr.close();$css.remove($("pnlPagination"),"hidden")}ActionBarMgr.show(b);ActionBarMgr.updateSelectionCount(FolderMgr.getSelectionCount());ActionBarMgr.updateMasterCheckbox(false);a._updateBreadCrumbs();if(c)window.scroll(0,0)};a.clearUi=function(){var b=a._getList();b.innerHTML=""};a._setSelection=function(b,a,c){var d=$("chk"+b);if(d.checked==a&&c)return;if(c)d.checked=a;FolderMgr.setSelected(b,a);var e=$("liMsg"+b);if(a)$css.add(e,"ml_sel");else $css.remove(e,"ml_sel")};a._updateBreadCrumbs=function(){if(window.$BreadCB){var a=StringMgr.fldrName,b=FolderMgr.getUnreadCount();if(b>0)a=a+" ("+b+")";$BreadCB.set_Link2(a)}};a._prepareRequest=function(b){$menu.closeCurrent();var a;if(typeof b!="undefined")a=[b];else if(FolderMgr.getSelectionCount()===0){NotifMgr.showMessage("noMsgsSel");return null}else a=FolderMgr.getSelectedMessagesIds();return a};a._updateReadUnreadCtxMenu=function(c,b){var a=$("lnkMarkRead"+c);if(a)a.innerHTML=b?StringMgr.unread:StringMgr.read};a._updateReadUnreadUi=function(b,c){var g=$("imgState"+b),e=$("pnlSndr"+b),d=FolderMgr.isRead(b);if(c?!d:d)FolderMgr.setUnreadCount(FolderMgr.getUnreadCount()+(c?-1:1));var i=a._getImageData(b).index;FolderMgr.setRead(b,c);var f=a._getImageData(b),h=f.index,j=h-i;$IS.toggle(g,j,f.alt);if(c)$css.remove(e,"ml_ur");else $css.add(e,"ml_ur");a._updateReadUnreadCtxMenu(b,c)};a._getImageData=function(a){if(FolderMgr.isRead(a))if(FolderMgr.isForwarded(a))return {index:2,alt:StringMgr.forwarded};else if(FolderMgr.isReplied(a))return {index:3,alt:StringMgr.replied};else return {index:1,alt:StringMgr.read};return {index:0,alt:StringMgr.unread}};a._getList=function(){return $("pnlML").getElementsByTagName("ul")[0]}}(function(){var b=document.getElementsByTagName("input");for(var a=0;a<b.length;a++)if(b[a].type=="checkbox"&&b[a].checked&&b[a].id&&b[a].id.substring(0,"chk".length)=="chk")b[a].checked=false})();window.FolderView=window.FolderView||new CFolderView;function CActionBarMgr(){var a=this;a._asyncCount=0;a.updateMasterCheckbox=function(c){for(var b=0;b<a._ids.length;b++)$("chk"+a._ids[b]).checked=c};a.show=function(c){for(var b=0;b<a._ids.length;b++){var d=c>=b+1;$(a._ids[b]).style.display=d?"block":"none"}};a.startAsync=function(){if(a._asyncCount===0)a._showLoadingBar(true);a._asyncCount++};a.completeAsync=function(){a._asyncCount--;if(a._asyncCount===0)a._showLoadingBar(false)};a.updateSelectionCount=function(c){for(var b=0;b<a._ids.length;b++){var d=$("pnlCount"+a._ids[b]);d.innerHTML=c>0?"&nbsp("+c+")":""}};a._showLoadingBar=function(c){var e=c?$css.add:$css.remove,d=c?$css.remove:$css.add;for(var b=0;b<a._ids.length;b++){e($("pnlRfr"+a._ids[b]),"hidden");d($("pnlLdn"+a._ids[b]),"hidden")}}}window.ActionBarMgr=window.ActionBarMgr||new CActionBarMgr